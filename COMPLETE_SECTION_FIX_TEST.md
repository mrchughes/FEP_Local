#!/bin/bash

echo "🧪 COMPREHENSIVE FORM TESTING PLAN"
echo "=================================="
echo "Testing fixes for missing sections and data clearing issues"

echo ""
echo "✅ FIXES IMPLEMENTED:"
echo "===================="
echo "1. Fixed field name mismatch in formProgress.js (evidence section)"
echo "2. Added missing fields to form steps:"
echo "   - Step 4: Added 'Was this their usual address?' field"
echo "   - Step 5: Added 'Next of kin details' and 'Other responsible person' fields"
echo "   - Step 6: Added 'Date of funeral' and 'Location of funeral' fields"
echo "   - Step 7: Added 'Employment status' and 'Other income' fields"
echo "3. Added guards to prevent data clearing during initial load"
echo "4. Prevented auto-save while data is still loading from database"

echo ""
echo "🔍 TEST PROCEDURE:"
echo "=================="

echo ""
echo "Test 1: Verify All Form Sections Collect Complete Data"
echo "-----------------------------------------------------"
echo "1. Login to application"
echo "2. Start a new form and fill out each section completely:"

echo ""
echo "   Section 1 - Personal Details:"
echo "   ✓ First Name: John"
echo "   ✓ Last Name: Smith"  
echo "   ✓ Date of Birth: 1990-01-01"
echo "   ✓ National Insurance: AB123456C"

echo ""
echo "   Section 2 - Contact Details:"
echo "   ✓ Address: 123 Test Street, London"
echo "   ✓ Postcode: SW1A 1AA"
echo "   ✓ Phone: 07700 900123"
echo "   ✓ Email: john.smith@example.com"

echo ""
echo "   Section 3 - About the person who died:"
echo "   ✓ First Name: Jane"
echo "   ✓ Last Name: Smith"
echo "   ✓ Date of Birth: 1960-05-15"
echo "   ✓ Date of Death: 2024-12-01"
echo "   ✓ Relationship: Spouse or civil partner"

echo ""
echo "   Section 4 - Address of the person who died:"
echo "   ✓ Address: 123 Test Street, London"
echo "   ✓ Postcode: SW1A 1AA"
echo "   🆕 Was this their usual address?: Yes"

echo ""
echo "   Section 5 - Responsibility for funeral arrangements:"
echo "   ✓ Why responsible: I am the partner of the person who died"
echo "   🆕 Next of kin details: (optional field)"
echo "   🆕 Other responsible person: (optional field)"

echo ""
echo "   Section 6 - Funeral details:"
echo "   ✓ Funeral Director: Smith & Sons Funeral Directors"
echo "   ✓ Cost: 5000"
echo "   ✓ Burial or Cremation: Burial"
echo "   🆕 Date of funeral: (optional field)"
echo "   🆕 Location of funeral: (optional field)"

echo ""
echo "   Section 7 - Financial circumstances:"
echo "   ✓ Benefits: Universal Credit"
echo "   ✓ Savings: No"
echo "   🆕 Employment status: (optional field)"
echo "   🆕 Other income: (optional field)"

echo ""
echo "   Section 8 - Evidence and documentation:"
echo "   ✓ Documents: Death certificate, Funeral bill or estimate"

echo ""
echo "   Section 9 - Declaration:"
echo "   ✓ Information correct: Yes"
echo "   ✓ Notify changes: Yes"
echo "   ✓ Agree to terms: Yes"

echo ""
echo "3. Go to review page and verify ALL 9 sections appear"
echo "4. Check that each section shows all collected data"

echo ""
echo "Test 2: Verify Data Persistence (No Clearing Issue)"
echo "--------------------------------------------------"
echo "1. Complete form as above and go to review page"
echo "2. Navigate back to 'My applications' (dashboard)"
echo "3. Verify application still shows progress"
echo "4. Click 'Continue application' and verify data is still there"
echo "5. Go back to review page and verify data is still complete"

echo ""
echo "Test 3: Test Navigation Without Data Loss"
echo "----------------------------------------"
echo "1. From review page, use browser back button"
echo "2. Navigate to different pages and back"
echo "3. Verify data remains intact throughout"

echo ""
echo "Test 4: Verify Task List Shows All Sections"
echo "-------------------------------------------"
echo "1. Go to task list page (/tasks)"
echo "2. Verify all 9 sections are listed:"
echo "   - Your personal details"
echo "   - Your contact details"
echo "   - About the person who died"
echo "   - Address of the person who died"
echo "   - Responsibility for funeral arrangements"
echo "   - Funeral details"
echo "   - Your financial circumstances"
echo "   - Evidence and documentation"
echo "   - Declaration"
echo "3. Verify section completion status is accurate"

echo ""
echo "🎯 EXPECTED RESULTS:"
echo "==================="
echo "✅ All 9 sections appear in form, task list, and review page"
echo "✅ All fields are collected and displayed correctly"
echo "✅ Data persists when navigating between pages"
echo "✅ No data clearing occurs unless user actually submits"
echo "✅ Review page shows complete data in GOV.UK format"

echo ""
echo "🚨 FAILURE INDICATORS:"
echo "======================"
echo "❌ Missing sections in review page"
echo "❌ Empty fields that should have data"
echo "❌ Data clearing when navigating to dashboard"
echo "❌ Incomplete task list"
echo "❌ Console errors in browser"

echo ""
echo "🚀 Ready to test! Please follow the procedure above and report any issues."
